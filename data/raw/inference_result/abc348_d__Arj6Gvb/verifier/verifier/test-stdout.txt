
======== SOLUTION.PY CONTENT ========
from collections import deque, defaultdict

def solve():
    # Read input
    H, W = map(int, input().split())
    grid = []
    for _ in range(H):
        grid.append(input().strip())

    N = int(input())
    medicines = {}
    for _ in range(N):
        r, c, e = map(int, input().split())
        medicines[(r-1, c-1)] = e  # Convert to 0-indexed

    # Find start and goal positions
    start = None
    goal = None
    for i in range(H):
        for j in range(W):
            if grid[i][j] == 'S':
                start = (i, j)
            elif grid[i][j] == 'T':
                goal = (i, j)

    # Use BFS, but track the maximum energy we've achieved at each position
    # The key insight: if we reach a cell with energy E, we don't need to revisit
    # with lower or equal energy. But we can revisit with higher energy.
    max_energy_at = defaultdict(lambda: -1)

    queue = deque([(start[0], start[1], 0)])  # (row, col, energy)
    max_energy_at[(start[0], start[1])] = 0

    directions = [(0, 1), (1, 0), (0, -1), (-1, 0)]
    max_possible_energy = H * W  # Maximum useful energy

    while queue:
        r, c, energy = queue.popleft()

        # Check if we reached the goal
        if (r, c) == goal:
            print("Yes")
            return

        # Try using medicine at current position (set energy to medicine value)
        if (r, c) in medicines:
            new_energy = medicines[(r, c)]
            if new_energy > max_energy_at[(r, c)]:
                max_energy_at[(r, c)] = new_energy
                queue.append((r, c, new_energy))

        # Try moving to adjacent cells
        if energy > 0:  # Can only move if energy > 0
            for dr, dc in directions:
                nr, nc = r + dr, c + dc
                if 0 <= nr < H and 0 <= nc < W and grid[nr][nc] != '#':
                    new_energy = energy - 1
                    if new_energy > max_energy_at[(nr, nc)]:
                        max_energy_at[(nr, nc)] = new_energy
                        queue.append((nr, nc, new_energy))

    print("No")

solve()

======== END OF SOLUTION.PY CONTENT ========

Input: 4 4
S...
#..#
#...
..#T
4
1 1 3
1 3 5
3 2 1
2 3 1

(stdin test) PASSED public_test_1 (test time: 0.02s)
Input: 2 2
S.
T.
1
1 2 4

(stdin test) PASSED public_test_2 (test time: 0.02s)
Input: 4 5
..#..
.S##.
.##T.
.....
3
3 1 5
1 2 3
2 2 1

(stdin test) PASSED public_test_3 (test time: 0.01s)
Input: 200 200
...............................................................................................
(stdin test) PASSED private_test_1 (test time: 0.02s)
Input: 200 200
.........................#.........................#......#..............................#.....
(stdin test) PASSED private_test_2 (test time: 0.05s)
Input: 200 200
...............................................................................................
(stdin test) PASSED private_test_3 (test time: 0.06s)
Input: 200 200
...............................................................................................
(stdin test) PASSED private_test_4 (test time: 0.06s)
Input: 200 200
T#.............................................................................................
(stdin test) PASSED private_test_5 (test time: 0.06s)
Input: 200 200
...#...#...#...#...#...#...#...#...#...#...#...#...#...#...#...#...#...#...#...#...#...#...#...
(stdin test) PASSED private_test_6 (test time: 0.06s)
Input: 200 200
...............................................................................................
(stdin test) PASSED private_test_7 (test time: 0.03s)
Input: 200 200
...............................................................................................
(stdin test) PASSED private_test_8 (test time: 3.64s)
Input: 200 200
.#.#...#.#...#....#.#...#..#..#...#.#....#..#...#...#..#..#..#...#........#.....#.#...#....#...
(stdin test) PASSED private_test_9 (test time: 0.02s)
Input: 200 200
#..#...##...#....#...##.##...#.##..###..##.....#.#.....##..##.......#...#.......###.#.....#....
(stdin test) PASSED private_test_10 (test time: 0.04s)
Input: 200 200
###...#.....#.#..##..###.#..#..##.#.#.###...#.#...#..#....#..#..##.#.#..##.########....##..#...
(stdin test) PASSED private_test_11 (test time: 0.05s)
Input: 200 200
...#...#...#...#...#...#...#...#...#...#...#...#...#...#...#...#...#...#...#...#...#...#...#...
(stdin test) PASSED private_test_12 (test time: 0.06s)
Input: 200 200
...............................................................................................
(stdin test) PASSED private_test_13 (test time: 0.03s)
Input: 200 200
#...#.#....#..#....#..#.....#.#.#.#....#..#........#.#..#.....#..#.......#.#...#.....#.#...#...
(stdin test) PASSED private_test_14 (test time: 0.04s)
Input: 200 200
..#.#.#...#.#.#.#...#.#.....#.....#.#.......#...#...#......#...#...#.#....#....#...#.#.##.#....
(stdin test) PASSED private_test_15 (test time: 0.05s)
Input: 200 200
......................................................................#...#...#...#...#...#....
(stdin test) PASSED private_test_16 (test time: 0.06s)
Input: 200 200
S..............................................................................................
(stdin test) PASSED private_test_17 (test time: 0.06s)
Input: 200 200
...............................................................................................
(stdin test) PASSED private_test_18 (test time: 0.04s)
Input: 200 200
...............................................................................................
(stdin test) PASSED private_test_19 (test time: 0.07s)
Input: 200 200
.#...#..#.#...#.....#..#....#......#....#........##...#...#..#..#..#.#.#...#..#....#..#..#.....
(stdin test) PASSED private_test_20 (test time: 0.02s)
Input: 200 200
...............................................................................................
(stdin test) PASSED private_test_21 (test time: 0.02s)
Input: 200 200
#.#..#.....#.#.##.#..#....#.......#..#.#....#...#.#.#..#.....#.#.#.#.##..#.....#..#...#.#..#...
(stdin test) PASSED private_test_22 (test time: 0.08s)
Input: 200 200
..##.....#.#..#...#.#.....#.#..#.#.....#.##.#...#...#.#.#..#..#..##..#..#....#......#.#.#......
(stdin test) PASSED private_test_23 (test time: 0.08s)
Input: 200 200
........##..#..........##.#..##......#...#.........#.....#.......##..#.##.#......#....##..#....
(stdin test) PASSED private_test_24 (test time: 0.09s)
Input: 200 200
...............................................................................................
(stdin test) PASSED private_test_25 (test time: 0.02s)
=========================== short test summary info ============================
PASSED public_test_1
PASSED public_test_2
PASSED public_test_3
PASSED private_test_1
PASSED private_test_2
PASSED private_test_3
PASSED private_test_4
PASSED private_test_5
PASSED private_test_6
PASSED private_test_7
PASSED private_test_8
PASSED private_test_9
PASSED private_test_10
PASSED private_test_11
PASSED private_test_12
PASSED private_test_13
PASSED private_test_14
PASSED private_test_15
PASSED private_test_16
PASSED private_test_17
PASSED private_test_18
PASSED private_test_19
PASSED private_test_20
PASSED private_test_21
PASSED private_test_22
PASSED private_test_23
PASSED private_test_24
PASSED private_test_25
=========================== 28 passed in 0.01s ===========================

ðŸŽ‰ TASK PASSED: All 28 tests passed!
